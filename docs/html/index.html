<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Rickards LSTM implementation: Reccurent neural network</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Rickards LSTM implementation
   &#160;<span id="projectnumber">v1.1</span>
   </div>
   <div id="projectbrief">A showcase in C</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Reccurent neural network </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In the process of designing systems that can adapt and learn patterns we explore on a basic, fundamental, level theories about how complex biological systems, such as human brains, work. I find this very fascinating. A recurrent neural network is a system that contains feedback loops and can store information from the past. This is necessary in order to model long-term dependencies such as can be found in natural language processing.</p>
<p>This program will learn to produce text similar to the one that it has been training on using a LSTM network implemented in C. The repo is inspired by Andrej Karpathys <em>char-rnn</em>: <a href="https://github.com/karpathy/char-rnn">https://github.com/karpathy/char-rnn</a> but instead implemented in C to be used in more constrained environments.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Build</h1>
<p>Do you have a mac or a Linux machine? In that case it is super easy to download and run.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Mac or Linux (UNIX types)</h2>
<p>Download the program. Open a terminal window and type:</p>
<pre>
# (You may have to install 'git', if you don't already have it!)
git clone <a href="https://github.com/Ricardicus/recurrent-neural-net/">https://github.com/Ricardicus/recurrent-neural-net/</a>
cd recurrent-neural-net
# This will compile the program. You need the compiler 'gcc' which is also available for download just like 'git'.
make
</pre><p>If there is any complaints, then remove some flags in the 'makefile', I use 'msse3' on my mac but it does not work for my raspberry Pi for example.</p>
<p>Then run the program: </p><pre>
./net datafile 
</pre><p>where datafile is a file with the traning data and it will start training on it. You can see the progress over time.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Windows</h2>
<p>I have only built it using Visual Studio Native Tools Command Prompt for VS2017.</p>
<p>Install CMake and Nmake (and git). Then do:</p>
<pre>
git clone <a href="https://github.com/Ricardicus/recurrent-neural-net/">https://github.com/Ricardicus/recurrent-neural-net/</a>
cd recurrent-neural-net
cmake -G"NMake Makefiles"
nmake
</pre><p># Configure</p>
<p>Check out the file "std_conf.h".</p>
<p>In <a class="el" href="std__conf_8h.html" title="Definitions that set the standard behaviour of the network.">std_conf.h</a> you can edit the program. You can edit the hyperparameters such as learning rate etc, set the number of layers (2/3 is best I think), set how often it should output data etc. If you edit this file, you edit the source code and you will need to rebuild the program with the command "make". You can also use input arguments to set some of the behaviour.</p>
<p>Running the program with no arguments triggers the help output to be displayed. This help shows what flags can be passed as arguments to the program to modify its behaviour. The output looks like this:</p>
<pre>
Usage: ./net datafile [flag value]*</pre><pre>Flags can be used to change the training procedure.
The flags require a value to be passed as the following argument.
    E.g., this is how you train with a learning rate set to 0.03:
        ./net datafile -lr 0.03</pre><pre>The following flags are available:
    -r  : read a previously trained network, the name of which is currently configured to be 'lstm_net.net'.
    -lr : learning rate that is to be used during training, see the example above.
    -it : the number of iterations used for training (not to be confused with epochs).
    -mb : mini batch size.
    -dl : decrease the learning rate over time, according to lr(n+1) &lt;- lr(n) / (1 + n/value).
    -st : number of iterations between how the network is continously stored during training (.json and .net).
    -out: number of characters to output directly, note: a network and a datafile must be provided.
    -L  : Number of layers, may not exceed 10</pre><pre>Check <a class="el" href="std__conf_8h.html" title="Definitions that set the standard behaviour of the network.">std_conf.h</a> to see what default values are used, these are set during compilation.</pre><pre>./net compiled Dec 21 2019 14:08:20</pre><pre></pre><p>The -st flags is great. Per default the network is stored upon interrupting the program with Ctrl-C. But using this argument, you can let the program train and have it store the network continously during the training process. In that case the network is avaiable for you even if the program is unexpectedly terminated.</p>
<p>Enjoy! :)</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Examples</h1>
<p>I trained this program to read the first Harry Potter book, It produced quotes such as this:</p>
<p>"Iteration: 303400, Loss: 0.07877, output: ed Aunt Petunia suggested
timidly, hours later, but Uncle Vernon was pointing at what had a thing while the next day. The Dursleys swut them on, the boy. "</p>
<p>It has definately learned something.</p>
<p>For more activity based on this neural network, check out my twitter bot: <a href="https://twitter.com/RicardicusPi">https://twitter.com/RicardicusPi</a></p>
<h1><a class="anchor" id="autotoc_md5"></a>
Comments</h1>
<p>For now I have just started with the implementation.</p>
<p>I figured if it was to be implemented in C instead of Python then there would be a huge speedup which the results show!</p>
<p>I will give this some time and hopefully I figure out a way that optimizes the program even more for speed.. Until then, have a go at this little program and edit it as you please!</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Build</h1>
<p>I use GCC and compile with with: gcc *.c -O3 -Ofast -msse3 -lm</p>
<p>Try to optimize it the way you want using the compiler at hand!</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Additional interesting stuff</h1>
<p>Under the folder 'html' you will find a document that can be used to play around with pre-trained models.</p>
<p>Below is an image of this GUI and how one can interact with it.</p>
<p><img src="https://raw.githubusercontent.com/Ricardicus/recurrent-neural-net/master/html/Screendump_example.png" alt="" class="inline"/></p>
<p>In the image of the GUI above, we see that a word is about to be formed starting with the letter <em>i</em>. The most likely words to be formed are: <em>if</em>, <em>in</em> and <em>it</em>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
